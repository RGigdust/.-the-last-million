<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>The Last Million | Royal Rise</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #020502; overflow: hidden; font-family: 'Cairo', sans-serif; }
        .ui-header { position: fixed; top: 15px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 1000; pointer-events: none; }
        .glass-box { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); padding: 5px 20px; border-radius: 15px; border: 1px solid gold; color: gold; text-align: center; box-shadow: 0 0 15px rgba(212, 175, 55, 0.2); }
        .rank-text { font-size: 0.7rem; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
        .balance-text { font-size: 1.4rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="ui-header">
        <div class="glass-box">
            <div id="rank-label" class="rank-text">شبل ناشئ</div>
            <div class="balance-text"><span id="score-display">0.000</span> <small style="font-size: 10px;">$LAST</small></div>
        </div>
    </div>

    <div id="game-container"></div>

    <script>
        const config = {
            type: Phaser.AUTO, width: window.innerWidth, height: window.innerHeight,
            parent: 'game-container', transparent: true,
            physics: { default: 'arcade' },
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let player, target, score, aura;

        function preload() {
            this.load.image('lion', 'wingedlionpng.png');
            this.load.image('tree', 'https://cdn-icons-png.flaticon.com/512/490/490391.png');
            this.load.image('aura', 'https://cdn-icons-png.flaticon.com/512/8636/8636034.png'); // صورة للهالة
        }

        function create() {
            // استعادة البيانات المحفوظة
            score = parseFloat(localStorage.getItem('lion_score')) || 0;
            
            this.physics.world.setBounds(0, 0, 5000, 5000);

            // إضافة الأشجار
            for (let i = 0; i < 80; i++) {
                this.add.image(Phaser.Math.Between(0, 5000), Phaser.Math.Between(0, 5000), 'tree').setScale(0.3).setAlpha(0.2);
            }

            // إنشاء الهالة (مخفية في البداية)
            aura = this.add.image(0, 0, 'aura').setScale(0.5).setAlpha(0).setTint(0xffd700);

            // إنشاء اللاعب بحجمه المحفوظ
            let startScale = 0.2 + (score * 0.005);
            if (startScale > 0.6) startScale = 0.6; 

            player = this.physics.add.sprite(2500, 2500, 'lion').setScale(startScale);
            player.setDepth(100);

            this.cameras.main.startFollow(player, true, 0.05, 0.05);
            updateCameraZoom(this, score);

            this.input.on('pointerdown', (pointer) => {
                target = pointer.positionToCamera(this.cameras.main);
                this.physics.moveToObject(player, target, 250 + (score * 2)); // تزيد السرعة قليلاً مع النمو
            });
        }

        function update() {
            if (target) {
                let dist = Phaser.Math.Distance.Between(player.x, player.y, target.x, target.y);
                if (dist < 10) { player.body.reset(target.x, target.y); target = null; }
                player.setFlipX(player.body.velocity.x < 0);
                
                // تحديث الرصيد والحفظ
                score += 0.001;
                updateUI();
                
                // النمو التدريجي
                if (player.scale < 0.6) {
                    player.setScale(player.scale + 0.00001);
                    updateCameraZoom(this, score);
                }

                // إظهار الهالة لو أصبح "ملك"
                if (score > 10) {
                    aura.setPosition(player.x, player.y + 20);
                    aura.setAlpha(0.3);
                    aura.setDepth(99);
                    aura.rotation += 0.02;
                }
            }
            
            // حفظ البيانات كل 100 فريم تحسينًا للأداء
            if (Phaser.Math.Between(0, 100) > 98) {
                localStorage.setItem('lion_score', score);
            }
        }

        function updateUI() {
            document.getElementById('score-display').innerText = score.toFixed(3);
            let label = document.getElementById('rank-label');
            if (score > 50) label.innerText = "الإمبراطور الأخير";
            else if (score > 10) label.innerText = "الأسد الملك";
            else if (score > 2) label.innerText = "السبع الفتي";
            else label.innerText = "شبل ناشئ";
        }

        function updateCameraZoom(scene, s) {
            let zoomLevel = 1.2 - (s * 0.01);
            if (zoomLevel < 0.7) zoomLevel = 0.7;
            scene.cameras.main.setZoom(zoomLevel);
        }
    </script>
</body>
</html>
