<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>The Last Million | The Oasis Update</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #020502; overflow: hidden; font-family: 'Arial', sans-serif; }
        .ui-overlay { position: fixed; top: 0; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 100; pointer-events: none; }
        .hunt-timer { background: rgba(255, 0, 0, 0.6); color: white; padding: 5px 20px; border-radius: 0 0 15px 15px; border: 1px solid white; font-weight: bold; }
        .chat-bubble { position: absolute; background: white; border-radius: 10px; padding: 5px; font-size: 12px; display: none; }
    </style>
</head>
<body>

    <div class="ui-overlay">
        <div class="hunt-timer">â³ ÙŠØ¨Ø¯Ø£ Ù…ÙˆØ³Ù… Ø§Ù„ØµÙŠØ¯ Ø®Ù„Ø§Ù„: <span id="timer">05:00</span></div>
    </div>

    <div id="game-container"></div>

    <script>
        const config = {
            type: Phaser.AUTO, width: window.innerWidth, height: window.innerHeight,
            parent: 'game-container',
            physics: { default: 'arcade' },
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let player, target, light, oasis, trees;

        function preload() {
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£ØµÙˆÙ„ (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ø§Ø­Ù‚Ø§Ù‹)
            this.load.image('lion', 'https://cdn-icons-png.flaticon.com/512/616/616412.png');
            this.load.image('tree', 'https://cdn-icons-png.flaticon.com/512/490/490391.png');
        }

        function create() {
            this.physics.world.setBounds(0, 0, 4000, 4000);
            this.lights.enable().setAmbientColor(0x222222);

            // 1. Ø¥Ù†Ø´Ø§Ø¡ "Ù†Ø¨Ø¹ Ø§Ù„Ù‚ÙˆØ©" (Ø§Ù„Ø¨Ø­ÙŠØ±Ø©)
            oasis = this.add.circle(2000, 2000, 350, 0x00aaff, 0.4);
            oasis.setPipeline('Light2D');
            this.add.text(2000, 2000, "ğŸ’§ Ù†Ø¨Ø¹ Ø§Ù„Ù‚ÙˆØ©\n(Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„)", { align: 'center', fill: '#fff', fontSize: '20px' }).setOrigin(0.5);

            // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„ÙƒØ«ÙŠÙØ©
            trees = this.physics.add.staticGroup();
            for (let i = 0; i < 180; i++) {
                let x = Phaser.Math.Between(0, 4000);
                let y = Phaser.Math.Between(0, 4000);
                // Ù…Ù†Ø¹ Ø§Ù„Ø´Ø¬Ø± Ù…Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø­ÙŠØ±Ø©
                if (Phaser.Math.Distance.Between(x, y, 2000, 2000) > 400) {
                    let tree = trees.create(x, y, 'tree').setScale(0.5).setOrigin(0.5, 1).setPipeline('Light2D');
                    tree.setDepth(y);
                }
            }

            // 3. Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ù„Ø£Ø³Ø¯ Ø§Ù„Ù…Ù„Ùƒ)
            player = this.physics.add.sprite(2000, 2200, 'lion').setScale(0.25).setPipeline('Light2D');
            player.setCollideWorldBounds(true);

            // 4. Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ©
            light = this.lights.addLight(0, 0, 450).setIntensity(2);

            this.cameras.main.startFollow(player, true, 0.1, 0.1);

            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ø³Ø¯
            this.input.on('pointerdown', (pointer) => {
                target = pointer.positionToCamera(this.cameras.main);
                this.physics.moveToObject(player, target, 250);
            });
        }

        function update() {
            light.x = player.x;
            light.y = player.y;
            player.setDepth(player.y);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø³Ø¯ ÙÙŠ Ø§Ù„Ø¨Ø­ÙŠØ±Ø© (Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø·Ø§Ù‚Ø©)
            let distToWater = Phaser.Math.Distance.Between(player.x, player.y, 2000, 2000);
            if (distToWater < 350) {
                player.setTint(0x00ffff); // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø³Ø¯ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø§Ø¦ÙŠ
            } else {
                player.clearTint();
            }

            if (target) {
                let dist = Phaser.Math.Distance.Between(player.x, player.y, target.x, target.y);
                if (dist < 10) { player.body.reset(target.x, target.y); target = null; }
                player.setFlipX(player.body.velocity.x < 0);
            }
        }
    </script>
</body>
</html>
