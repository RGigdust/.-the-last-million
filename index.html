<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>The Last Million | Kingdom</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #050a05; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 80%; max-width: 400px; background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px); border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 25px; z-index: 3000; padding: 20px; color: white;
            text-align: center; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .modal.active { transform: translate(-50%, -50%) scale(1); }
        .modal h2 { color: gold; margin-top: 0; }
        .close-btn { background: gold; color: black; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 15px; }
        
        #game-ui { position: fixed; top: 15px; width: 100%; text-align: center; z-index: 1000; pointer-events: none; color: gold; font-size: 20px; }
    </style>
</head>
<body>

    <div id="game-ui">Ø§Ù„Ø³ÙŠØ§Ø¯Ø©: <span id="score">0</span> $LAST</div>

    <div id="cave-modal" class="modal">
        <h2>ğŸ‘‘ Ø¹Ø±Ø´ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</h2>
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø±ÙŠÙ†Ùƒ Ø§Ù„Ø®Ø§Øµ. Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØ© Ø±ØªØ¨ØªÙƒ ÙˆØ¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©.</p>
        <button class="close-btn" onclick="closeModal('cave-modal')">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØºØ§Ø¨Ø©</button>
    </div>

    <div id="shop-modal" class="modal">
        <h2>ğŸ›’ Ø³ÙˆÙ‚ Ø§Ù„ØºØ§Ø¨Ø©</h2>
        <p>Ø·ÙˆØ± Ù…Ø®Ø§Ù„Ø¨Ùƒ ÙˆØ²Ø¯ Ø³Ø±Ø¹ØªÙƒ Ù„ØªØµØ·Ø§Ø¯ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø¹Ù…Ù„Ø§Øª $LAST.</p>
        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;">Ø¹Ù†ØµØ± Ù‚Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§Ù‹...</div>
        <button class="close-btn" onclick="closeModal('shop-modal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div id="game"></div>

    <script>
        const config = {
            type: Phaser.AUTO, width: window.innerWidth, height: window.innerHeight,
            parent: 'game', transparent: true,
            physics: { default: 'arcade' },
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let player, target, landmarks;

        function preload() {
            this.load.image('lion', 'wingedlionpng.png');
            this.load.image('cave', 'https://cdn-icons-png.flaticon.com/512/13600/13600392.png');
            this.load.image('shop', 'https://cdn-icons-png.flaticon.com/512/1162/1162456.png');
        }

        function create() {
            this.physics.world.setBounds(0, 0, 3000, 3000);
            landmarks = this.physics.add.staticGroup();

            let cave = landmarks.create(1500, 300, 'cave').setScale(0.3).refreshBody();
            cave.id = 'cave-modal';

            let shop = landmarks.create(2500, 1500, 'shop').setScale(0.3).refreshBody();
            shop.id = 'shop-modal';

            player = this.physics.add.sprite(1500, 1500, 'lion').setScale(0.3);
            player.setCollideWorldBounds(true);

            this.cameras.main.startFollow(player, true, 0.05, 0.05);

            this.input.on('pointerdown', (pointer) => {
                if (document.querySelector('.modal.active')) return; // Ù…Ù†Ø¹ Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„Ù†Ø§ÙØ°Ø© Ù…ÙØªÙˆØ­Ø©
                target = pointer.positionToCamera(this.cameras.main);
                this.physics.moveToObject(player, target, 250);
            });

            // Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ù…
            this.physics.add.overlap(player, landmarks, (p, landmark) => {
                openModal(landmark.id);
                player.body.stop(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£Ø³Ø¯ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„
            }, null, this);
        }

        function update() {
            if (target && player.body.speed > 0) {
                let dist = Phaser.Math.Distance.Between(player.x, player.y, target.x, target.y);
                if (dist < 10) player.body.reset(target.x, target.y);
                player.setFlipX(player.body.velocity.x < 0);
            }
        }

        function openModal(id) {
            document.getElementById(id).classList.add('active');
            if (window.Telegram?.WebApp) window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            target = null; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù‡Ø¯Ù Ù„Ø¨Ø¯Ø¡ Ø­Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©
        }
    </script>
</body>
</html>
